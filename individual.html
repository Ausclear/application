<!DOCTYPE html>
<html lang="en-AU">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AusClear Individual Application</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        const API_BASE = 'https://portal.ausclear.au/api';
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #003366 0%, #004080 100%);
            color: white;
            padding: 25px 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        .page-tabs {
            display: flex;
            gap: 30px;
            justify-content: center;
            align-items: center;
        }

        .page-tab {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            position: relative;
        }

        .page-tab.active {
            background: rgba(255, 255, 255, 0.2);
            border-color: white;
            color: white;
        }

        .page-tab.completed {
            background: #4CAF50;
            border-color: #4CAF50;
            color: transparent;
        }

        .page-tab.completed::after {
            content: '✓';
            position: absolute;
            font-size: 16px;
            font-weight: bold;
            color: white;
        }

        .main-content {
            padding: 30px;
            padding-bottom: 120px;
            background: linear-gradient(to bottom, #f8fbff 0%, #ffffff 100%);
        }

        .form-page {
            display: none;
        }

        .form-page.active {
            display: block;
        }

        .notice-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
        }

        .notice-box strong {
            display: block;
            margin-bottom: 10px;
            color: #856404;
            font-size: 1.1rem;
        }

        .notice-box p {
            color: #856404;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: #003366;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
            font-size: 16px;
        }

        .required {
            color: #e74c3c;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: #f9f9f9;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #003366;
            background: white;
            box-shadow: 0 0 0 3px rgba(0, 51, 102, 0.1);
        }

        .form-input.error {
            border-color: #e74c3c;
            background: #fef2f2;
        }

        .form-input.verified {
            border-color: #4CAF50;
            background: #f0f9f0;
        }

        .form-input.readonly {
            background: #f3f4f6;
            color: #6b7280;
            cursor: not-allowed;
        }

        .form-select {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: #f9f9f9;
            transition: all 0.3s ease;
        }

        .form-select:focus {
            outline: none;
            border-color: #003366;
            background: white;
            box-shadow: 0 0 0 3px rgba(0, 51, 102, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 0.7fr 1fr 1fr;
            gap: 15px;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .radio-group.horizontal {
            flex-direction: row;
            gap: 30px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .radio-option:hover {
            background-color: #f8fafc;
        }

        .radio-input {
            width: 20px;
            height: 20px;
            accent-color: #003366;
        }

        .help-text {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .validation-message {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .validation-message.valid {
            color: #38a169;
        }

        .validation-message.invalid {
            color: #e53e3e;
        }

        .validation-message.checking {
            color: #ed8936;
        }

        .validation-icon {
            font-size: 16px;
        }

        .spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .navigation {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            max-width: 800px;
            width: 100%;
            background: white;
            padding: 20px 30px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
        }

        .nav-button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-button.back {
            background: #f8f9fa;
            color: #003366;
            border: 1px solid #003366;
        }

        .nav-button.back:hover {
            background: #e2e8f0;
        }

        .nav-button.next {
            background: #003366;
            color: white;
        }

        .nav-button.next:hover {
            background: #004080;
            transform: translateY(-1px);
        }

        .abn-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
        }

        .abn-modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            text-align: center;
            position: relative;
        }

        .abn-modal h3 {
            color: #003366;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .abn-company-info {
            background: #f8fafc;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #4CAF50;
        }

        .abn-company-info h4 {
            color: #4CAF50;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .abn-company-info p {
            margin: 5px 0;
            color: #374151;
        }

        .abn-modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .abn-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .abn-btn.confirm {
            background: #003366;
            color: white;
        }

        .abn-btn.confirm:hover {
            background: #004080;
            transform: translateY(-1px);
        }

        .abn-btn.change {
            background: #f59e0b;
            color: white;
        }

        .abn-btn.change:hover {
            background: #d97706;
            transform: translateY(-1px);
        }

        .terms-box {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .terms-box h4 {
            color: #003366;
            margin: 15px 0 10px 0;
            font-size: 1rem;
        }

        .terms-box p {
            margin-bottom: 10px;
        }

        @media (max-width: 600px) {
            .form-row, .form-row-3 {
                grid-template-columns: 1fr;
            }
            
            .main-content {
                padding: 20px;
                padding-bottom: 120px;
            }
            
            .navigation {
                padding: 15px 20px;
            }

            .radio-group.horizontal {
                flex-direction: column;
                gap: 15px;
            }

            .abn-modal-content {
                padding: 25px 20px;
            }

            .abn-modal-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <span style="font-size: 3rem; display: block; margin-bottom: 10px;">📋</span>
                <span style="font-size: 28px; font-weight: 700; letter-spacing: 1px;">AusClear Smart Logic</span>
                <span style="display: block; font-size: 16px; font-weight: 400; opacity: 0.9; margin-top: 5px;">Security Clearance Application</span>
                <div style="width: 60px; height: 3px; background: linear-gradient(90deg, #28a745, #20803a); margin: 10px auto; border-radius: 2px;"></div>
            </h1>
            <div class="page-tabs">
                <div class="page-tab active" id="tab1">1</div>
                <div class="page-tab" id="tab2">2</div>
                <div class="page-tab" id="tab3">3</div>
                <div class="page-tab" id="tab4">4</div>
                <div class="page-tab" id="tab5">5</div>
                <div class="page-tab" id="tab6">6</div>
            </div>
        </div>

        <div class="main-content">
            <form action="https://forms.zohopublic.com.au/AusClear/form/AusClearClientLeadForm/formperma/qn7JcSrpxW50HttROlH7UtL8LgPaV1JOPBHLVtHxdcA/htmlRecords/submit" method="POST" id="applicationForm" accept-charset="UTF-8" enctype="multipart/form-data">
                
                <input type="hidden" name="zf_referrer_name" value="">
                <input type="hidden" name="zf_redirect_url" value="">
                <input type="hidden" name="zc_gad" value="">
                <input type="hidden" name="SingleLine7" id="referenceNumberField">

                <!-- Page 1 - Personal Information -->
                <div class="form-page active" id="page1">
                    <h2 class="page-title">Personal Information</h2>
                    
                    <div class="notice-box">
                        <strong>Important Notice</strong>
                        <p>Please ensure that you complete the form in full. It is crucial to provide accurate and complete information to avoid any delays in processing your application. Incomplete forms may result in additional processing time or rejection. Thank you for your cooperation.</p>
                    </div>

                    <div class="form-row-3">
                        <div class="form-group">
                            <label class="form-label">Title <span class="required">*</span></label>
                            <select name="Name_Salutation" class="form-select" required>
                                <option value="">Select</option>
                                <option value="Mr.">Mr.</option>
                                <option value="Mrs.">Mrs.</option>
                                <option value="Ms.">Ms.</option>
                                <option value="Miss">Miss</option>
                                <option value="Dr.">Dr.</option>
                                <option value="Prof.">Prof.</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Legal First Name <span class="required">*</span></label>
                            <input type="text" name="Name_First" class="form-input" id="legalFirstName" style="text-transform: capitalize;" onchange="updateDeclarationName()" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Legal Last Name <span class="required">*</span></label>
                            <input type="text" name="Name_Last" class="form-input" id="legalLastName" style="text-transform: uppercase;" onchange="updateDeclarationName()" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Preferred Name</label>
                            <input type="text" name="SingleLine" class="form-input" style="text-transform: capitalize;">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Job Title</label>
                            <input type="text" name="SingleLine6" class="form-input" style="text-transform: capitalize;">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Client Type <span class="required">*</span></label>
                        <div class="radio-group horizontal">
                            <label class="radio-option">
                                <input type="radio" name="Radio4" value="Individual" class="radio-input" required>
                                <span>Individual</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="Radio4" value="Referral Partner Individual" class="radio-input">
                                <span>Referral Partner Individual</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="Radio4" value="Referred By Friend" class="radio-input">
                                <span>Referred By Friend</span>
                            </label>
                        </div>
                        <div class="help-text">Please choose carefully</div>
                    </div>
                </div>

                <!-- Page 2 - Clearance Requirements -->
                <div class="form-page" id="page2">
                    <h2 class="page-title">Clearance Requirements</h2>
                    
                    <div class="form-group">
                        <label class="form-label">Clearance Request Type <span class="required">*</span></label>
                        <div class="radio-group horizontal">
                            <label class="radio-option">
                                <input type="radio" name="Radio2" value="New" class="radio-input" required>
                                <span>New</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="Radio2" value="Upgrade" class="radio-input">
                                <span>Upgrade</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="Radio2" value="Transfer" class="radio-input">
                                <span>Transfer</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Clearance Required <span class="required">*</span></label>
                        <div class="radio-group horizontal">
                            <label class="radio-option">
                                <input type="radio" name="Radio3" value="Baseline Security Clearance" class="radio-input" required>
                                <span>Baseline Security Clearance</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="Radio3" value="NV1 Security Clearance" class="radio-input">
                                <span>NV1 Security Clearance</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="Radio3" value="NV2 Security Clearance" class="radio-input">
                                <span>NV2 Security Clearance</span>
                            </label>
                        </div>
                        <div class="help-text">Type of Clearance Required</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Australian Citizen <span class="required">*</span></label>
                        <div class="radio-group horizontal">
                            <label class="radio-option">
                                <input type="radio" name="Radio" value="Yes" class="radio-input" required>
                                <span>Yes</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="Radio" value="No" class="radio-input" onclick="showNonCitizenModal()">
                                <span>No</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Date of Birth <span class="required">*</span></label>
                            <input type="text" name="Date" class="form-input" id="dob_picker" placeholder="Select date" required readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Country of Birth <span class="required">*</span></label>
                            <select name="Dropdown2" class="form-select" required>
                                <option value="">-Select-</option>
                                <option value="Afghanistan">Afghanistan</option>
                                <option value="Albania">Albania</option>
                                <option value="Algeria">Algeria</option>
                                <option value="Andorra">Andorra</option>
                                <option value="Angola">Angola</option>
                                <option value="Antigua & Deps">Antigua & Deps</option>
                                <option value="Argentina">Argentina</option>
                                <option value="Armenia">Armenia</option>
                                <option value="Australia">Australia</option>
                                <option value="Austria">Austria</option>
                                <option value="Azerbaijan">Azerbaijan</option>
                                <option value="Bahamas">Bahamas</option>
                                <option value="Bahrain">Bahrain</option>
                                <option value="Bangladesh">Bangladesh</option>
                                <option value="Barbados">Barbados</option>
                                <option value="Belarus">Belarus</option>
                                <option value="Belgium">Belgium</option>
                                <option value="Belize">Belize</option>
                                <option value="Benin">Benin</option>
                                <option value="Bhutan">Bhutan</option>
                                <option value="Bolivia">Bolivia</option>
                                <option value="Bosnia Herzegovina">Bosnia Herzegovina</option>
                                <option value="Botswana">Botswana</option>
                                <option value="Brazil">Brazil</option>
                                <option value="Brunei">Brunei</option>
                                <option value="Bulgaria">Bulgaria</option>
                                <option value="Burkina">Burkina</option>
                                <option value="Burma">Burma</option>
                                <option value="Burundi">Burundi</option>
                                <option value="Cambodia">Cambodia</option>
                                <option value="Cameroon">Cameroon</option>
                                <option value="Canada">Canada</option>
                                <option value="Cape Verde">Cape Verde</option>
                                <option value="Central African Rep">Central African Rep</option>
                                <option value="Chad">Chad</option>
                                <option value="Chile">Chile</option>
                                <option value="China">China</option>
                                <option value="Colombia">Colombia</option>
                                <option value="Comoros">Comoros</option>
                                <option value="Congo {Democratic Rep}">Congo {Democratic Rep}</option>
                                <option value="Congo">Congo</option>
                                <option value="Costa Rica">Costa Rica</option>
                                <option value="Croatia">Croatia</option>
                                <option value="Cuba">Cuba</option>
                                <option value="Cyprus">Cyprus</option>
                                <option value="Czech Republic">Czech Republic</option>
                                <option value="Denmark">Denmark</option>
                                <option value="Djibouti">Djibouti</option>
                                <option value="Dominica">Dominica</option>
                                <option value="Dominican Republic">Dominican Republic</option>
                                <option value="East Timor">East Timor</option>
                                <option value="Ecuador">Ecuador</option>
                                <option value="Egypt">Egypt</option>
                                <option value="El Salvador">El Salvador</option>
                                <option value="Equatorial Guinea">Equatorial Guinea</option>
                                <option value="Eritrea">Eritrea</option>
                                <option value="Estonia">Estonia</option>
                                <option value="Ethiopia">Ethiopia</option>
                                <option value="Fiji">Fiji</option>
                                <option value="Finland">Finland</option>
                                <option value="France">France</option>
                                <option value="Gabon">Gabon</option>
                                <option value="Gambia">Gambia</option>
                                <option value="Georgia">Georgia</option>
                                <option value="Germany">Germany</option>
                                <option value="Ghana">Ghana</option>
                                <option value="Greece">Greece</option>
                                <option value="Grenada">Grenada</option>
                                <option value="Guatemala">Guatemala</option>
                                <option value="Guinea">Guinea</option>
                                <option value="Guinea-Bissau">Guinea-Bissau</option>
                                <option value="Guyana">Guyana</option>
                                <option value="Haiti">Haiti</option>
                                <option value="Honduras">Honduras</option>
                                <option value="Hungary">Hungary</option>
                                <option value="Iceland">Iceland</option>
                                <option value="India">India</option>
                                <option value="Indonesia">Indonesia</option>
                                <option value="Iran">Iran</option>
                                <option value="Iraq">Iraq</option>
                                <option value="Ireland {Republic}">Ireland {Republic}</option>
                                <option value="Israel">Israel</option>
                                <option value="Italy">Italy</option>
                                <option value="Ivory Coast">Ivory Coast</option>
                                <option value="Jamaica">Jamaica</option>
                                <option value="Japan">Japan</option>
                                <option value="Jordan">Jordan</option>
                                <option value="Kazakhstan">Kazakhstan</option>
                                <option value="Kenya">Kenya</option>
                                <option value="Kiribati">Kiribati</option>
                                <option value="Korea North">Korea North</option>
                                <option value="Korea South">Korea South</option>
                                <option value="Kosovo">Kosovo</option>
                                <option value="Kuwait">Kuwait</option>
                                <option value="Kyrgyzstan">Kyrgyzstan</option>
                                <option value="Laos">Laos</option>
                                <option value="Latvia">Latvia</option>
                                <option value="Lebanon">Lebanon</option>
                                <option value="Lesotho">Lesotho</option>
                                <option value="Liberia">Liberia</option>
                                <option value="Libya">Libya</option>
                                <option value="Liechtenstein">Liechtenstein</option>
                                <option value="Lithuania">Lithuania</option>
                                <option value="Luxembourg">Luxembourg</option>
                                <option value="Macedonia">Macedonia</option>
                                <option value="Madagascar">Madagascar</option>
                                <option value="Malawi">Malawi</option>
                                <option value="Malaysia">Malaysia</option>
                                <option value="Maldives">Maldives</option>
                                <option value="Mali">Mali</option>
                                <option value="Malta">Malta</option>
                                <option value="Marshall Islands">Marshall Islands</option>
                                <option value="Mauritania">Mauritania</option>
                                <option value="Mauritius">Mauritius</option>
                                <option value="Mexico">Mexico</option>
                                <option value="Micronesia">Micronesia</option>
                                <option value="Moldova">Moldova</option>
                                <option value="Monaco">Monaco</option>
                                <option value="Mongolia">Mongolia</option>
                                <option value="Montenegro">Montenegro</option>
                                <option value="Morocco">Morocco</option>
                                <option value="Mozambique">Mozambique</option>
                                <option value="Myanmar">Myanmar</option>
                                <option value="Namibia">Namibia</option>
                                <option value="Nauru">Nauru</option>
                                <option value="Nepal">Nepal</option>
                                <option value="Netherlands">Netherlands</option>
                                <option value="New Zealand">New Zealand</option>
                                <option value="Nicaragua">Nicaragua</option>
                                <option value="Niger">Niger</option>
                                <option value="Nigeria">Nigeria</option>
                                <option value="Norway">Norway</option>
                                <option value="Oman">Oman</option>
                                <option value="Pakistan">Pakistan</option>
                                <option value="Palau">Palau</option>
                                <option value="Panama">Panama</option>
                                <option value="Papua New Guinea">Papua New Guinea</option>
                                <option value="Paraguay">Paraguay</option>
                                <option value="Peru">Peru</option>
                                <option value="Philippines">Philippines</option>
                                <option value="Poland">Poland</option>
                                <option value="Portugal">Portugal</option>
                                <option value="Qatar">Qatar</option>
                                <option value="Romania">Romania</option>
                                <option value="Russian Federation">Russian Federation</option>
                                <option value="Rwanda">Rwanda</option>
                                <option value="Saint Vincent & the Grenadines">Saint Vincent & the Grenadines</option>
                                <option value="Samoa">Samoa</option>
                                <option value="San Marino">San Marino</option>
                                <option value="Sao Tome & Principe">Sao Tome & Principe</option>
                                <option value="Saudi Arabia">Saudi Arabia</option>
                                <option value="Senegal">Senegal</option>
                                <option value="Serbia">Serbia</option>
                                <option value="Seychelles">Seychelles</option>
                                <option value="Sierra Leone">Sierra Leone</option>
                                <option value="Singapore">Singapore</option>
                                <option value="Slovakia">Slovakia</option>
                                <option value="Slovenia">Slovenia</option>
                                <option value="Solomon Islands">Solomon Islands</option>
                                <option value="Somalia">Somalia</option>
                                <option value="South Africa">South Africa</option>
                                <option value="Spain">Spain</option>
                                <option value="Sri Lanka">Sri Lanka</option>
                                <option value="St Kitts & Nevis">St Kitts & Nevis</option>
                                <option value="St Lucia">St Lucia</option>
                                <option value="Sudan">Sudan</option>
                                <option value="Suriname">Suriname</option>
                                <option value="Swaziland">Swaziland</option>
                                <option value="Sweden">Sweden</option>
                                <option value="Switzerland">Switzerland</option>
                                <option value="Syria">Syria</option>
                                <option value="Taiwan">Taiwan</option>
                                <option value="Tajikistan">Tajikistan</option>
                                <option value="Tanzania">Tanzania</option>
                                <option value="Thailand">Thailand</option>
                                <option value="Togo">Togo</option>
                                <option value="Tonga">Tonga</option>
                                <option value="Trinidad & Tobago">Trinidad & Tobago</option>
                                <option value="Tunisia">Tunisia</option>
                                <option value="Turkey">Turkey</option>
                                <option value="Turkmenistan">Turkmenistan</option>
                                <option value="Tuvalu">Tuvalu</option>
                                <option value="Uganda">Uganda</option>
                                <option value="Ukraine">Ukraine</option>
                                <option value="United Arab Emirates">United Arab Emirates</option>
                                <option value="United Kingdom">United Kingdom</option>
                                <option value="United States">United States</option>
                                <option value="Uruguay">Uruguay</option>
                                <option value="Uzbekistan">Uzbekistan</option>
                                <option value="Vanuatu">Vanuatu</option>
                                <option value="Vatican City">Vatican City</option>
                                <option value="Venezuela">Venezuela</option>
                                <option value="Vietnam">Vietnam</option>
                                <option value="Yemen">Yemen</option>
                                <option value="Zambia">Zambia</option>
                                <option value="Zimbabwe">Zimbabwe</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Page 3 - Contact Details -->
                <div class="form-page" id="page3">
                    <h2 class="page-title">Contact Details</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Email <span class="required">*</span></label>
                            <input type="email" name="Email" class="form-input" id="emailInput" required>
                            <div id="emailValidation" class="validation-message" style="display: none;">
                                <i class="fas fa-spinner spinner validation-icon" id="emailSpinner" style="display: none;"></i>
                                <i class="fas fa-check-circle validation-icon" id="emailCheck" style="display: none;"></i>
                                <i class="fas fa-exclamation-circle validation-icon" id="emailError" style="display: none;"></i>
                                <span id="emailText"></span>
                            </div>
                            <div class="help-text">This must be your personal email</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Mobile Number <span class="required">*</span></label>
                            <input type="tel" name="PhoneNumber_countrycode" class="form-input" id="mobileNumber" placeholder="0412345678" maxlength="10" required pattern="[0-9]{10}">
                            <input type="hidden" name="PhoneNumber_countrycodeval" value="+61">
                            <div class="help-text">Must be your 10 digit phone number</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Street Address <span class="required">*</span></label>
                        <div style="position: relative;">
                            <input type="text" name="Address_AddressLine1" class="form-input" id="streetAddress" placeholder="Start typing your address..." required>
                            <div id="addressSuggestions" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #d1d5db; border-top: none; border-radius: 0 0 8px 8px; max-height: 200px; overflow-y: auto; z-index: 50; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);"></div>
                        </div>
                        <div class="help-text">Start typing in the address field above and select from suggestions, or fill in manually</div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Suburb <span class="required">*</span></label>
                            <input type="text" name="Address_City" class="form-input" id="suburb" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">State <span class="required">*</span></label>
                            <input type="text" name="Address_Region" class="form-input" id="state" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Postal Code <span class="required">*</span></label>
                            <input type="text" name="Address_ZipCode" class="form-input" id="postalCode" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Country <span class="required">*</span></label>
                            <select name="Address_Country" class="form-select" required>
                                <option value="Australia" selected>Australia</option>
                                <option value="United States">United States</option>
                                <option value="United Kingdom">United Kingdom</option>
                                <option value="New Zealand">New Zealand</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Page 4 - Business & Payment -->
                <div class="form-page" id="page4">
                    <h2 class="page-title">Business & Payment Details</h2>
                    
                    <div class="form-group">
                        <label class="form-label">Do you have an ABN? <span class="required">*</span></label>
                        <div class="radio-group horizontal">
                            <label class="radio-option">
                                <input type="radio" name="Dropdown3" value="Yes" class="radio-input" onchange="toggleABNField(true)" required>
                                <span>Yes</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="Dropdown3" value="No" class="radio-input" onchange="toggleABNField(false)">
                                <span>No</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group" id="abnNumberGroup" style="display: none;">
                        <label class="form-label">ABN Number <span class="required">*</span></label>
                        <div style="position: relative;">
                            <input type="text" name="SingleLine2" class="form-input" id="abnNumber" placeholder="86 132 015 334" maxlength="14" oninput="handleABNInput(this.value)">
                            <div id="abnStatus" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); font-size: 20px; display: none;"></div>
                        </div>
                        <div class="help-text">Enter your Australian Business Number (ABN)</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Payment Preference <span class="required">*</span></label>
                        <div class="radio-group horizontal">
                            <label class="radio-option">
                                <input type="radio" name="Radio5" value="Upfront" class="radio-input" required>
                                <span>Upfront</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="Radio5" value="4 Monthly instalments" class="radio-input">
                                <span>4 Monthly instalments</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">How did you hear about us?</label>
                            <select name="Dropdown5" class="form-select">
                                <option value="">-Select-</option>
                                <option value="Advertisement">Advertisement</option>
                                <option value="Affiliate Program">Affiliate Program</option>
                                <option value="Blog or Content Marketing">Blog or Content Marketing</option>
                                <option value="Chat">Chat</option>
                                <option value="Cold Call">Cold Call</option>
                                <option value="Community Events">Community Events</option>
                                <option value="Direct Mail">Direct Mail</option>
                                <option value="Email Campaign">Email Campaign</option>
                                <option value="Employee Referral">Employee Referral</option>
                                <option value="Event Sponsorship">Event Sponsorship</option>
                                <option value="External Referral">External Referral</option>
                                <option value="Facebook">Facebook</option>
                                <option value="Flyers/Posters">Flyers/Posters</option>
                                <option value="Google Search">Google Search</option>
                                <option value="Google+">Google+</option>
                                <option value="Industry Conferences">Industry Conferences</option>
                                <option value="Influencer Marketing">Influencer Marketing</option>
                                <option value="Instagram">Instagram</option>
                                <option value="LinkedIn">LinkedIn</option>
                                <option value="Networking Event">Networking Event</option>
                                <option value="Online Review (Google Review)">Online Review (Google Review)</option>
                                <option value="Online Store">Online Store</option>
                                <option value="Paid Advertisement (Google A)">Paid Advertisement (Google A)</option>
                                <option value="Partner">Partner</option>
                                <option value="Partnerships">Partnerships</option>
                                <option value="Press Release/Media Coverage">Press Release/Media Coverage</option>
                                <option value="Public Relations">Public Relations</option>
                                <option value="Radio/TV Commercial">Radio/TV Commercial</option>
                                <option value="Referral">Referral</option>
                                <option value="Referred By a Friend">Referred By a Friend</option>
                                <option value="Sales Email Alias">Sales Email Alias</option>
                                <option value="Sales Representative">Sales Representative</option>
                                <option value="Search Engine Optimization (SEO)">Search Engine Optimization (SEO)</option>
                                <option value="Seminar Internal">Seminar Internal</option>
                                <option value="Seminar Partner">Seminar Partner</option>
                                <option value="SMS Campaign">SMS Campaign</option>
                                <option value="Trade Show">Trade Show</option>
                                <option value="Twitter">Twitter</option>
                                <option value="Video Marketing (YouTube)">Video Marketing (YouTube)</option>
                                <option value="Vimeo">Vimeo</option>
                                <option value="Web Download">Web Download</option>
                                <option value="Web Research">Web Research</option>
                                <option value="Webinars/Online Events">Webinars/Online Events</option>
                                <option value="Website">Website</option>
                                <option value="Word of Mouth">Word of Mouth</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Industry Background</label>
                            <select name="Dropdown1" class="form-select">
                                <option value="">-Select-</option>
                                <option value="Aerospace">Aerospace</option>
                                <option value="Agriculture">Agriculture</option>
                                <option value="Biotechnology">Biotechnology</option>
                                <option value="Construction Services">Construction Services</option>
                                <option value="Construction">Construction</option>
                                <option value="Consulting">Consulting</option>
                                <option value="Cyber Security">Cyber Security</option>
                                <option value="Defence">Defence</option>
                                <option value="Education Sector">Education Sector</option>
                                <option value="Energy">Energy</option>
                                <option value="Engineering">Engineering</option>
                                <option value="Finance Sector">Finance Sector</option>
                                <option value="Government">Government</option>
                                <option value="Healthcare">Healthcare</option>
                                <option value="Hospitality & Tourism">Hospitality & Tourism</option>
                                <option value="IT">IT</option>
                                <option value="Insurance">Insurance</option>
                                <option value="Legal">Legal</option>
                                <option value="Manufacturing">Manufacturing</option>
                                <option value="Marketing & Advertising">Marketing & Advertising</option>
                                <option value="Media & Entertainment">Media & Entertainment</option>
                                <option value="Mining">Mining</option>
                                <option value="Nonprofit">Nonprofit</option>
                                <option value="Pharmaceuticals">Pharmaceuticals</option>
                                <option value="Real Estate">Real Estate</option>
                                <option value="Recruitment Agency">Recruitment Agency</option>
                                <option value="Renewable Energy">Renewable Energy</option>
                                <option value="Research & Development">Research & Development</option>
                                <option value="Retail">Retail</option>
                                <option value="SME (Small and Medium Enterprise)">SME (Small and Medium Enterprise)</option>
                                <option value="Self Employed">Self Employed</option>
                                <option value="Service Provider">Service Provider</option>
                                <option value="Space">Space</option>
                                <option value="Telecommunications">Telecommunications</option>
                                <option value="Transport & Logistics">Transport & Logistics</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Page 5 - Security Clearance History -->
                <div class="form-page" id="page5">
                    <h2 class="page-title">Security Clearance History</h2>
                    
                    <div class="form-group">
                        <label class="form-label">Have you previously held or do you currently hold a security clearance? <span class="required">*</span></label>
                        <div class="radio-group horizontal">
                            <label class="radio-option">
                                <input type="radio" name="Radio1" value="Yes" class="radio-input" onchange="toggleClearanceFields(true)" required>
                                <span>Yes</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="Radio1" value="No" class="radio-input" onchange="toggleClearanceFields(false)">
                                <span>No</span>
                            </label>
                        </div>
                    </div>

                    <div id="clearanceFieldsGroup" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">Historical Clearance Level <span class="required">*</span></label>
                            <div class="radio-group horizontal">
                                <label class="radio-option">
                                    <input type="radio" name="Dropdown" value="Baseline" class="radio-input">
                                    <span>Baseline</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="Dropdown" value="NV1" class="radio-input">
                                    <span>NV1</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="Dropdown" value="NV2" class="radio-input">
                                    <span>NV2</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="Dropdown" value="PV" class="radio-input">
                                    <span>PV</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">CSID Number</label>
                                <input type="text" name="Number" class="form-input" maxlength="18">
                                <div class="help-text">CSID Number if known</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Sponsoring Organisation</label>
                                <input type="text" name="SingleLine1" class="form-input">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Page 6 - Terms & Conditions -->
                <div class="form-page" id="page6">
                    <h2 class="page-title">Terms & Conditions</h2>
                    
                    <div class="form-group">
                        <label class="form-label">Terms and Conditions <span class="required">*</span></label>
                        
                        <div class="terms-box">
                            <h4>Terms and Conditions</h4>
                            
                            <h4>1. Accuracy</h4>
                            <p>All information provided must be complete and correct. Inform AusClear promptly of any updates.</p>
                            
                            <h4>2. Application Review</h4>
                            <p>Applications are reviewed before being cleared to proceed. If declined, you'll be notified with next steps.</p>
                            
                            <h4>3. False or Missing Information</h4>
                            <p>Providing false or incomplete details may result in delays, rejection, or cancellation. You may also be liable for any costs incurred.</p>
                            
                            <h4>4. Required Information</h4>
                            <p>All sections must be completed, including current or past security clearance details. Omissions may delay your application.</p>
                            
                            <h4>5. Acknowledgement</h4>
                            <p>By submitting this form, you confirm your agreement to these terms and consent to the use of your information under applicable privacy laws. Submission does not guarantee sponsorship or clearance approval.</p>
                        </div>

                        <div style="background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 8px; padding: 20px; margin: 25px 0; max-width: 400px;">
                            <label class="form-label" style="margin-bottom: 12px;">Human Verification <span class="required">*</span></label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 16px; font-weight: 500; color: #333;">What is <span id="mathNum1"></span> + <span id="mathNum2"></span>?</span>
                                <input type="number" class="form-input" id="mathAnswer" required style="width: 80px; padding: 10px; text-align: center;">
                            </div>
                            <div id="mathValidation" style="display: none; margin-top: 8px; font-size: 14px; font-weight: 500;"></div>
                        </div>

                        <label class="radio-option" style="margin-top: 20px; display: flex; align-items: flex-start; padding: 15px; background: #e7f5ff; border-radius: 8px;">
                            <input type="checkbox" name="TermsConditions" class="radio-input" required style="margin-top: 3px; flex-shrink: 0;">
                            <span style="margin-left: 10px;">
                                <strong>Declaration:</strong><br>
                                I, <span id="declarationName" style="font-weight: bold; border-bottom: 2px solid #ccc; padding: 2px 5px; margin: 0 5px; min-width: 200px; display: inline-block;">_________________</span>, hereby declare that I have read, understood, and accept the terms and conditions outlined in this application form. I agree to comply with all the requirements specified, and I confirm that the information provided is true, accurate, and complete to the best of my knowledge. By submitting this form, I acknowledge and accept the terms, and agree to proceed with the application process.
                            </span>
                        </label>
                    </div>
                </div>
            </form>
        </div>

        <div class="navigation">
            <button type="button" class="nav-button back" onclick="previousPage()" id="backBtn" style="visibility: hidden;">
                ← Back
            </button>
            <button type="button" class="nav-button next" onclick="nextPage()" id="nextBtn">
                Next →
            </button>
        </div>
    </div>

    <!-- ABN Confirmation Modal -->
    <div id="abnModal" class="abn-modal">
        <div class="abn-modal-content">
            <h3>✅ ABN Verified Successfully</h3>
            
            <div class="abn-company-info">
                <h4 id="abnCompanyName">Entity Name</h4>
                <p><strong>ABN:</strong> <span id="abnNumberDisplay"></span></p>
                <p><strong>Status:</strong> Active and Valid</p>
            </div>
            
            <p style="color: #6b7280; font-size: 14px; margin: 15px 0;">
                Is this the correct business?
            </p>
            
            <div class="abn-modal-buttons">
                <button class="abn-btn confirm" onclick="confirmABN()">
                    ✅ Yes, this is correct
                </button>
                <button class="abn-btn change" onclick="changeABN()">
                    🔄 Enter different ABN
                </button>
            </div>
        </div>
    </div>

    <!-- Verification Error Modal -->
    <div id="verificationModal" class="abn-modal">
        <div class="abn-modal-content">
            <h3 style="color: #e74c3c;">⚠️ Verification Required</h3>
            
            <p style="color: #374151; font-size: 16px; line-height: 1.6; margin: 20px 0;">
                Please answer the verification question correctly before submitting your application.
            </p>
            
            <div style="text-align: center; margin-top: 25px;">
                <button class="abn-btn confirm" onclick="closeVerificationModal()" style="background: #003366;">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Validation Error Modal -->
    <div id="validationModal" class="abn-modal">
        <div class="abn-modal-content">
            <h3 style="color: #e74c3c;">⚠️ Required Fields Missing</h3>
            
            <p style="color: #374151; font-size: 16px; line-height: 1.6; margin: 20px 0;">
                Please fill in all mandatory fields before proceeding to the next page.
            </p>
            
            <div style="text-align: center; margin-top: 25px;">
                <button class="abn-btn confirm" onclick="closeValidationModal()" style="background: #003366;">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Submitting Modal -->
    <div id="submittingModal" class="abn-modal" style="display: none;">
        <div class="abn-modal-content">
            <div style="font-size: 48px; margin-bottom: 20px;">
                <i class="fas fa-spinner fa-spin" style="color: #003366;"></i>
            </div>
            <h3 style="color: #003366; margin-bottom: 15px;">Submitting Your Application</h3>
            <p style="color: #6b7280; font-size: 15px;">
                Please wait while we process your application...
            </p>
        </div>
    </div>

    <!-- Non-Citizen Modal -->
    <div id="nonCitizenModal" class="abn-modal">
        <div class="abn-modal-content">
            <h3 style="color: #e74c3c;">⚠️ Australian Citizenship Required</h3>
            
            <p style="color: #374151; font-size: 16px; line-height: 1.6; margin: 20px 0;">
                Unfortunately, Australian citizenship is a mandatory requirement for security clearance applications. 
            </p>
            
            <p style="color: #374151; font-size: 16px; line-height: 1.6; margin: 20px 0;">
                If you would like to discuss your situation further, please contact our support team:
            </p>
            
            <div style="background: #f8fafc; border-radius: 8px; padding: 20px; margin: 20px 0; text-align: left;">
                <p style="margin: 10px 0;"><strong>📞 Phone:</strong> 1300 027 423</p>
                <p style="margin: 10px 0;"><strong>✉️ Email:</strong> support@ausclear.com.au</p>
            </div>
            
            <div style="text-align: center; margin-top: 25px;">
                <button class="abn-btn confirm" onclick="closeNonCitizenModal()" style="background: #003366;">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        let currentPage = 1;
        const totalPages = 6;
        let abnTimeout = null;
        let abnVerificationResult = null;
        let abnConfirmed = false;
        let refNumber;
        let emailTimeout;
        let mathAnswer = 0;

        function generateReferenceNumber() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            return `AC-${year}${month}${day}-${hours}${minutes}${seconds}`;
        }

        refNumber = generateReferenceNumber();

        // Generate random math question
        function generateMathQuestion() {
            const num1 = Math.floor(Math.random() * 10) + 1;
            const num2 = Math.floor(Math.random() * 10) + 1;
            mathAnswer = num1 + num2;
            
            document.getElementById('mathNum1').textContent = num1;
            document.getElementById('mathNum2').textContent = num2;
        }

        // Validate math answer
        function validateMathAnswer() {
            const userAnswer = parseInt(document.getElementById('mathAnswer').value);
            const validation = document.getElementById('mathValidation');
            const answerField = document.getElementById('mathAnswer');
            
            if (isNaN(userAnswer)) {
                validation.style.display = 'none';
                answerField.classList.remove('verified', 'error');
                return false;
            }
            
            if (userAnswer === mathAnswer) {
                validation.textContent = '✅ Correct!';
                validation.style.color = '#38a169';
                validation.style.display = 'block';
                answerField.classList.remove('error');
                answerField.classList.add('verified');
                return true;
            } else {
                validation.textContent = '❌ Incorrect. Please try again.';
                validation.style.color = '#e53e3e';
                validation.style.display = 'block';
                answerField.classList.remove('verified');
                answerField.classList.add('error');
                return false;
            }
        }

        // Add event listener for math answer
        document.addEventListener('DOMContentLoaded', function() {
            const mathInput = document.getElementById('mathAnswer');
            if (mathInput) {
                mathInput.addEventListener('input', validateMathAnswer);
                mathInput.addEventListener('blur', validateMathAnswer);
            }
        });

        flatpickr("#dob_picker", {
            dateFormat: "d/m/Y",
            maxDate: "today",
            defaultDate: new Date(new Date().getFullYear() - 25, 0, 1),
            yearSelectorType: "dropdown",
            onReady: function(selectedDates, dateStr, instance) {
                const style = document.createElement('style');
                style.innerHTML = `
                    .flatpickr-day.selected, .flatpickr-day.selected:hover {
                        background: #003366 !important;
                        border-color: #003366 !important;
                    }
                    .flatpickr-day.today {
                        border-color: #003366 !important;
                    }
                    .flatpickr-day.today:hover {
                        background: #003366 !important;
                        color: white !important;
                    }
                    .flatpickr-months .flatpickr-prev-month:hover svg,
                    .flatpickr-months .flatpickr-next-month:hover svg {
                        fill: #003366 !important;
                    }
                `;
                document.head.appendChild(style);
            }
        });

        // Email Verification
        const emailInput = document.getElementById('emailInput');
        const emailValidation = document.getElementById('emailValidation');
        const emailSpinner = document.getElementById('emailSpinner');
        const emailCheck = document.getElementById('emailCheck');
        const emailError = document.getElementById('emailError');
        const emailText = document.getElementById('emailText');

        function showEmailValidation(type, message) {
            emailSpinner.style.display = 'none';
            emailCheck.style.display = 'none';
            emailError.style.display = 'none';
            
            emailValidation.className = 'validation-message';
            emailInput.classList.remove('verified', 'error');
            
            if (type === 'checking') {
                emailValidation.classList.add('checking');
                emailValidation.style.display = 'flex';
                emailSpinner.style.display = 'inline';
                emailText.textContent = message || 'Checking email...';
            } else if (type === 'valid') {
                emailValidation.classList.add('valid');
                emailValidation.style.display = 'flex';
                emailCheck.style.display = 'inline';
                emailInput.classList.add('verified');
                emailText.textContent = message || 'Email verified';
            } else if (type === 'invalid') {
                emailValidation.classList.add('invalid');
                emailValidation.style.display = 'flex';
                emailError.style.display = 'inline';
                emailInput.classList.add('error');
                emailText.textContent = message || 'Invalid email';
            } else {
                emailValidation.style.display = 'none';
            }
        }

        async function validateEmail() {
            const email = emailInput.value.trim();
            
            if (!email) {
                showEmailValidation('hide');
                return;
            }

            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showEmailValidation('invalid', 'Invalid email format');
                return;
            }

            showEmailValidation('checking', 'Verifying email address...');

            try {
                const response = await fetch(`${API_BASE}/validate-email`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: email })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                
                if (result.isValid) {
                    showEmailValidation('valid', result.message);
                } else {
                    showEmailValidation('invalid', result.message);
                }
            } catch (error) {
                console.error('Email validation error:', error);
                showEmailValidation('valid', 'Format valid (verification service unavailable)');
            }
        }

        emailInput.addEventListener('input', () => {
            clearTimeout(emailTimeout);
            emailTimeout = setTimeout(validateEmail, 1000);
        });

        emailInput.addEventListener('blur', validateEmail);

        function capitaliseText(text) {
            if (!text) return '';
            return text.toLowerCase().split(' ').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }

        function showPage(pageNum) {
            document.querySelectorAll('.form-page').forEach(page => {
                page.classList.remove('active');
            });
            
            document.querySelectorAll('.page-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(`page${pageNum}`).classList.add('active');
            document.getElementById(`tab${pageNum}`).classList.add('active');
            
            currentPage = pageNum;
            updateNavigation();
            updateTicksDisplay();
            
            // Generate math question when reaching page 6
            if (pageNum === 6 && mathAnswer === 0) {
                generateMathQuestion();
            }
        }

        function updateTicksDisplay() {
            for (let i = 1; i <= totalPages; i++) {
                const tab = document.getElementById(`tab${i}`);
                if (i < currentPage) {
                    tab.classList.add('completed');
                } else {
                    tab.classList.remove('completed');
                }
            }
        }

        function nextPage() {
            // Validate current page
            const currentPageElement = document.getElementById(`page${currentPage}`);
            let isValid = true;
            let checkedRadioGroups = new Set();
            
            console.log('Validating page:', currentPage);
            
            // Check all required fields on current page
            const requiredInputs = currentPageElement.querySelectorAll('[required]');
            console.log('Found required inputs:', requiredInputs.length);
            
            requiredInputs.forEach(input => {
                console.log('Checking input:', input.name, input.type, input.value);
                
                // Skip hidden inputs
                if (input.type === 'hidden') {
                    console.log('Skipping hidden input');
                    return;
                }
                
                // Skip inputs in hidden groups (like ABN field when "No" is selected)
                const parentGroup = input.closest('[id$="Group"]');
                if (parentGroup && parentGroup.style.display === 'none') {
                    console.log('Skipping hidden group input');
                    return;
                }
                
                // Check radio buttons (only once per group)
                if (input.type === 'radio') {
                    if (checkedRadioGroups.has(input.name)) {
                        console.log('Already checked this radio group');
                        return;
                    }
                    checkedRadioGroups.add(input.name);
                    
                    const radioGroup = currentPageElement.querySelectorAll(`input[name="${input.name}"]`);
                    const isChecked = Array.from(radioGroup).some(r => r.checked);
                    console.log('Radio group checked:', isChecked);
                    if (!isChecked) {
                        isValid = false;
                        console.log('INVALID: Radio not checked');
                    }
                    return;
                }
                
                // Check checkboxes
                if (input.type === 'checkbox') {
                    if (!input.checked) {
                        isValid = false;
                        console.log('INVALID: Checkbox not checked');
                    }
                    return;
                }
                
                // Check text inputs and selects
                if (!input.value || input.value.trim() === '' || input.value === '') {
                    isValid = false;
                    console.log('INVALID: Empty field');
                }
            });
            
            console.log('Final validation result:', isValid);
            
            // If validation fails, show modal
            if (!isValid) {
                console.log('Showing validation modal');
                document.getElementById('validationModal').style.display = 'flex';
                return;
            }
            
            // Move to next page or submit
            if (currentPage < totalPages) {
                showPage(currentPage + 1);
            } else {
                // Validate math answer on page 6
                const mathInput = document.getElementById('mathAnswer');
                const userAnswer = parseInt(mathInput.value);
                
                if (isNaN(userAnswer) || userAnswer !== mathAnswer) {
                    document.getElementById('verificationModal').style.display = 'flex';
                    return;
                }
                
                submitForm();
            }
        }

        function previousPage() {
            if (currentPage > 1) {
                showPage(currentPage - 1);
            }
        }

        function updateNavigation() {
            const backBtn = document.getElementById('backBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            backBtn.style.visibility = currentPage > 1 ? 'visible' : 'hidden';
            nextBtn.textContent = currentPage === totalPages ? 'Submit' : 'Next →';
        }

        function updateDeclarationName() {
            const firstName = document.getElementById('legalFirstName').value;
            const lastName = document.getElementById('legalLastName').value;
            const declarationName = document.getElementById('declarationName');
            
            if (firstName || lastName) {
                // Capitalize first letter of first name, uppercase entire last name
                const formattedFirstName = firstName.charAt(0).toUpperCase() + firstName.slice(1).toLowerCase();
                const formattedLastName = lastName.toUpperCase();
                declarationName.textContent = `${formattedFirstName} ${formattedLastName}`.trim();
                declarationName.style.textTransform = 'none';
            } else {
                declarationName.textContent = '_________________';
            }
        }

        function toggleABNField(show) {
            const abnGroup = document.getElementById('abnNumberGroup');
            const abnField = document.getElementById('abnNumber');
            
            if (show) {
                abnGroup.style.display = 'block';
                abnField.setAttribute('required', 'required');
            } else {
                abnGroup.style.display = 'none';
                abnField.removeAttribute('required');
                abnField.value = '';
                abnConfirmed = false;
                abnVerificationResult = null;
                closeABNModal();
                
                const abnStatus = document.getElementById('abnStatus');
                abnField.classList.remove('error', 'verified', 'readonly');
                abnField.removeAttribute('readonly');
                abnStatus.style.display = 'none';
            }
        }

        function toggleClearanceFields(show) {
            const clearanceFieldsGroup = document.getElementById('clearanceFieldsGroup');
            
            if (show) {
                clearanceFieldsGroup.style.display = 'block';
            } else {
                clearanceFieldsGroup.style.display = 'none';
            }
        }

        function handleABNInput(abnValue) {
            const cleanAbn = abnValue.replace(/[\s-]/g, '');
            const abnStatus = document.getElementById('abnStatus');
            const abnField = document.getElementById('abnNumber');
            
            // Format as XX XXX XXX XXX
            if (cleanAbn.length > 0) {
                let formatted = '';
                if (cleanAbn.length <= 2) {
                    formatted = cleanAbn;
                } else if (cleanAbn.length <= 5) {
                    formatted = cleanAbn.slice(0, 2) + ' ' + cleanAbn.slice(2);
                } else if (cleanAbn.length <= 8) {
                    formatted = cleanAbn.slice(0, 2) + ' ' + cleanAbn.slice(2, 5) + ' ' + cleanAbn.slice(5);
                } else {
                    formatted = cleanAbn.slice(0, 2) + ' ' + cleanAbn.slice(2, 5) + ' ' + cleanAbn.slice(5, 8) + ' ' + cleanAbn.slice(8, 11);
                }
                abnField.value = formatted;
            }
            
            abnConfirmed = false;
            
            if (abnTimeout) {
                clearTimeout(abnTimeout);
            }
            
            abnStatus.style.display = 'none';
            abnVerificationResult = null;
            
            if (cleanAbn.length === 11 && /^\d{11}$/.test(cleanAbn)) {
                abnStatus.innerHTML = '⏳';
                abnStatus.style.display = 'block';
                
                abnTimeout = setTimeout(() => {
                    verifyABN(cleanAbn);
                }, 1000);
            } else if (cleanAbn.length > 0) {
                abnStatus.innerHTML = '❌';
                abnStatus.style.display = 'block';
                abnField.classList.remove('verified');
                abnField.classList.add('error');
            } else {
                abnField.classList.remove('error', 'verified');
            }
        }

        async function verifyABN(abn) {
            const abnStatus = document.getElementById('abnStatus');
            const abnField = document.getElementById('abnNumber');
            
            try {
                const requestData = { 
                    abn: abn,
                    applicantName: ''
                };
                
                const response = await fetch(`${API_BASE}/abn-verify`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData),
                });

                const result = await response.json();
                abnVerificationResult = result;

                if (result.success) {
                    // Valid ABN with company entity name
                    if (result.valid && result.entityName) {
                        abnStatus.innerHTML = '✅';
                        abnStatus.style.display = 'block';
                        abnField.classList.remove('error');
                        abnField.classList.add('verified');
                        showABNModal(result, abn);
                    } 
                    // Valid ABN but no entity name (sole trader/individual)
                    else if (!result.valid && !result.entityName) {
                        abnStatus.innerHTML = '✅';
                        abnStatus.style.display = 'block';
                        abnField.classList.remove('error');
                        abnField.classList.add('verified');
                        showSoleTraderModal(abn);
                    }
                    // Invalid ABN
                    else {
                        abnStatus.innerHTML = '❌';
                        abnStatus.style.display = 'block';
                        abnField.classList.remove('verified');
                        abnField.classList.add('error');
                    }
                } else {
                    abnStatus.innerHTML = '⚠️';
                    abnStatus.style.display = 'block';
                    abnField.classList.remove('verified');
                    abnField.classList.add('error');
                }
            } catch (error) {
                abnStatus.innerHTML = '💥';
                abnStatus.style.display = 'block';
                abnField.classList.remove('verified');
                abnField.classList.add('error');
            }
        }

        function showABNModal(result, abn) {
            const modal = document.getElementById('abnModal');
            const companyNameEl = document.getElementById('abnCompanyName');
            const abnNumberEl = document.getElementById('abnNumberDisplay');
            
            companyNameEl.textContent = result.entityName;
            abnNumberEl.textContent = abn;
            
            modal.style.display = 'flex';
        }

        function showSoleTraderModal(abn) {
            const modal = document.getElementById('abnModal');
            const companyNameEl = document.getElementById('abnCompanyName');
            const abnNumberEl = document.getElementById('abnNumberDisplay');
            
            companyNameEl.textContent = 'Sole Trader / Individual';
            abnNumberEl.textContent = abn;
            
            modal.style.display = 'flex';
        }

        function confirmABN() {
            abnConfirmed = true;
            closeABNModal();
            
            const abnField = document.getElementById('abnNumber');
            abnField.classList.add('verified');
            abnField.classList.remove('error');
            abnField.setAttribute('readonly', 'readonly');
            abnField.classList.add('readonly');
        }

        function changeABN() {
            resetABNField();
            closeABNModal();
        }

        function closeABNModal() {
            document.getElementById('abnModal').style.display = 'none';
        }

        function closeVerificationModal() {
            document.getElementById('verificationModal').style.display = 'none';
            document.getElementById('mathAnswer').focus();
        }

        function closeValidationModal() {
            document.getElementById('validationModal').style.display = 'none';
        }

        function showNonCitizenModal() {
            document.getElementById('nonCitizenModal').style.display = 'flex';
            // Uncheck the "No" radio button so they have to select "Yes" to proceed
            setTimeout(() => {
                const noRadio = document.querySelector('input[name="Radio"][value="No"]');
                if (noRadio) {
                    noRadio.checked = false;
                }
            }, 100);
        }

        function closeNonCitizenModal() {
            document.getElementById('nonCitizenModal').style.display = 'none';
        }

        function resetABNField() {
            const abnField = document.getElementById('abnNumber');
            const abnStatus = document.getElementById('abnStatus');
            
            abnField.value = '';
            abnField.removeAttribute('readonly');
            abnField.classList.remove('readonly', 'verified', 'error');
            abnStatus.style.display = 'none';
            
            abnConfirmed = false;
            abnVerificationResult = null;
            closeABNModal();
            
            abnField.focus();
        }

        document.getElementById('mobileNumber').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '').slice(0, 10);
        });

        // Google Places Address Lookup
        let addressTimeout = null;

        const streetAddressInput = document.getElementById('streetAddress');
        if (streetAddressInput) {
            streetAddressInput.addEventListener('input', handleAddressInput);
        }

        function handleAddressInput(e) {
            const value = e.target.value;
            
            if (addressTimeout) {
                clearTimeout(addressTimeout);
            }
            
            addressTimeout = setTimeout(() => {
                searchAddresses(value);
            }, 500);
        }

        async function searchAddresses(query) {
            if (query.length < 3) {
                hideAddressSuggestions();
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/google-places`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        input: query,
                        sessionToken: Math.random().toString(36).substring(7)
                    }),
                });

                const result = await response.json();

                if (result.success && result.predictions) {
                    showAddressSuggestions(result.predictions);
                }
            } catch (error) {
                console.error('Address search error:', error);
            }
        }

        function showAddressSuggestions(predictions) {
            const container = document.getElementById('addressSuggestions');
            container.innerHTML = '';
            
            predictions.forEach(prediction => {
                const item = document.createElement('div');
                item.style.cssText = 'padding: 12px 16px; cursor: pointer; border-bottom: 1px solid #f3f4f6;';
                item.textContent = prediction.description;
                item.onclick = () => selectAddress(prediction);
                item.onmouseover = () => item.style.background = '#f9fafb';
                item.onmouseout = () => item.style.background = 'white';
                container.appendChild(item);
            });
            
            const poweredBy = document.createElement('div');
            poweredBy.style.cssText = 'padding: 8px 16px; font-size: 12px; color: #6b7280; text-align: right; font-style: italic; border-top: 2px solid #e5e7eb;';
            poweredBy.textContent = 'Powered by Google';
            container.appendChild(poweredBy);
            
            container.style.display = 'block';
        }

        function hideAddressSuggestions() {
            const container = document.getElementById('addressSuggestions');
            if (container) {
                container.style.display = 'none';
            }
        }

        async function selectAddress(prediction) {
            hideAddressSuggestions();
            document.getElementById('streetAddress').value = prediction.description;

            if (prediction.place_id) {
                try {
                    const response = await fetch(`${API_BASE}/place-details`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ place_id: prediction.place_id }),
                    });

                    const result = await response.json();

                    if (result.success && result.result && result.result.address_components) {
                        const addressComponents = result.result.address_components;
                        let streetNumber = '';
                        let route = '';
                        let locality = '';
                        let state = '';
                        let postcode = '';
                        
                        addressComponents.forEach(component => {
                            const types = component.types;
                            
                            if (types.includes('street_number')) {
                                streetNumber = component.long_name;
                            }
                            if (types.includes('route')) {
                                route = component.long_name;
                            }
                            if (types.includes('locality') || types.includes('sublocality')) {
                                locality = component.long_name;
                            }
                            if (types.includes('administrative_area_level_1')) {
                                state = component.short_name;
                            }
                            if (types.includes('postal_code')) {
                                postcode = component.long_name;
                            }
                        });

                        if (streetNumber && route) {
                            document.getElementById('streetAddress').value = `${streetNumber} ${route}`;
                        }
                        if (locality) {
                            document.getElementById('suburb').value = locality;
                        }
                        if (state) {
                            document.getElementById('state').value = state;
                        }
                        if (postcode) {
                            document.getElementById('postalCode').value = postcode;
                        }
                    }
                } catch (error) {
                    console.error('Address details error:', error);
                }
            }
        }

        document.addEventListener('click', function(e) {
            if (!e.target.closest('#streetAddress') && !e.target.closest('#addressSuggestions')) {
                hideAddressSuggestions();
            }
        });

        function submitForm() {
            // Final validation check
            const userAnswer = parseInt(document.getElementById('mathAnswer').value);
            if (isNaN(userAnswer) || userAnswer !== mathAnswer) {
                return;
            }
            
            // Capitalise job title before submission
            const jobTitleField = document.querySelector('input[name="SingleLine6"]');
            if (jobTitleField && jobTitleField.value) {
                jobTitleField.value = capitaliseText(jobTitleField.value);
            }
            
            // Show submitting modal
            document.getElementById('submittingModal').style.display = 'flex';
            
            document.getElementById('referenceNumberField').value = refNumber;
            
            const formData = new FormData(document.getElementById('applicationForm'));
            
            // Add a 2-3 second delay to show the spinner
            setTimeout(() => {
                fetch(document.getElementById('applicationForm').action, {
                    method: 'POST',
                    body: formData,
                    mode: 'no-cors'
                }).then(() => {
                    document.getElementById('submittingModal').style.display = 'none';
                    showSuccessModal();
                }).catch(() => {
                    document.getElementById('submittingModal').style.display = 'none';
                    showSuccessModal();
                });
            }, 2500);
        }

        function showSuccessModal() {
            const firstName = document.getElementById('legalFirstName').value;
            const lastName = document.getElementById('legalLastName').value;
            const formattedFirstName = firstName.charAt(0).toUpperCase() + firstName.slice(1).toLowerCase();
            const formattedLastName = lastName.toUpperCase();
            const applicantName = `${formattedFirstName} ${formattedLastName}`.trim();
            const currentDate = new Date().toLocaleDateString('en-AU');

            const modal = `
                <div id="submissionModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 2000; display: flex; align-items: center; justify-content: center; padding: 20px;">
                    <div style="background: white; border-radius: 12px; padding: 40px; max-width: 500px; width: 100%; text-align: center; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);">
                        <div style="font-size: 64px; margin-bottom: 25px;">✅</div>
                        <h2 style="color: #003366; margin-bottom: 20px; font-size: 28px;">Thank You!</h2>
                        <p style="color: #333; font-size: 1rem; line-height: 1.6; margin-bottom: 15px;">Your application has been successfully submitted for approval. We will review your information and process your application as soon as possible.</p>
                        
                        <div style="background: #e7f5ff; border: 2px solid #003366; padding: 20px; border-radius: 8px; margin: 25px 0;">
                            <strong style="display: block; color: #003366; font-size: 0.9rem; margin-bottom: 8px;">Your Reference Number:</strong>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #003366; letter-spacing: 1px;">${refNumber}</div>
                        </div>
                        
                        <p style="color: #666; font-size: 0.9rem; margin: 20px 0;">Please keep this reference number for your records. If any additional details or clarification are needed, our team will reach out to you directly.</p>
                        
                        <p style="margin-top: 20px;"><strong>Regards,<br>AusClear Support Team</strong></p>
                        
                        <button onclick="window.location.href='https://www.ausclear.com.au'" style="background: linear-gradient(135deg, #28a745 0%, #20803a 100%); color: white; border: none; padding: 14px 45px; font-size: 1rem; font-weight: 600; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; margin-top: 15px;">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modal);
        }

        document.getElementById('abnModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeABNModal();
            }
        });

        document.getElementById('verificationModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeVerificationModal();
            }
        });

        document.getElementById('validationModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeValidationModal();
            }
        });

        document.getElementById('nonCitizenModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeNonCitizenModal();
            }
        });
    </script>
</body>
</html>
